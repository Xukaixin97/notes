<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>scriptup | Macus</title>
    <meta name="description" content="setup">
    <link rel="stylesheet" href="/notes/assets/style.9314c058.css">
    <link rel="modulepreload" href="/notes/assets/Home.3c6be6ac.js">
    <link rel="modulepreload" href="/notes/assets/app.72f529ff.js">
    <link rel="modulepreload" href="/notes/assets/note_vue_scriptup.md.3bafb0dd.lean.js">
    <link rel="modulepreload" href="/notes/assets/app.72f529ff.js">
    <meta name="twitter:title" content="scriptup | Macus">
    <meta property="og:title" content="scriptup | Macus">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-7161a24b><div class="sidebar-button" data-v-7161a24b><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/notes/" aria-label="Macus, back to home" data-v-7161a24b data-v-4a583abe><!----> Macus</a><div class="flex-grow" data-v-7161a24b></div><div class="nav" data-v-7161a24b><nav class="nav-links" data-v-7161a24b data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-a9d8d3e2><a class="item" href="/notes/pages/archives" data-v-a9d8d3e2>Archives <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-a9d8d3e2><a class="item" href="/notes/pages/tags" data-v-a9d8d3e2>Tags <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-a9d8d3e2><a class="item active" href="/notes/note/" data-v-a9d8d3e2>All <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-94408616><nav class="nav-links nav" data-v-94408616 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-a9d8d3e2><a class="item" href="/notes/pages/archives" data-v-a9d8d3e2>Archives <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-a9d8d3e2><a class="item" href="/notes/pages/tags" data-v-a9d8d3e2>Tags <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-a9d8d3e2><a class="item active" href="/notes/note/" data-v-a9d8d3e2>All <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-94408616><!--[--><li class="sidebar-link"><p class="sidebar-link-item">js</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/notes/note/js/基础">基础</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">vue</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item active" href="/notes/note/vue/scriptup">scriptup</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#script-setup">&lt;script setup&gt;</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#top-level-bindings-are-exposed-to-template">Top level bindings are exposed to template</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#using-components">Using Components</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#using-dynamic-components">Using Dynamic Components</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#using-directives">Using Directives</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#declaring-props-and-emits">Declaring props and emits</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#using-slots-and-attrs">Using slots and attrs</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#type-only-props-emit-declarations">Type-only props/emit declarations</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#default-props-values-when-using-type-declaration">Default props values when using type declaration</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#top-level-await">Top level await</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#exposing-component-s-public-interface">Exposing component&#39;s public interface</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#usage-alongside-normal-script">Usage alongside normal &lt;script&gt;</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#automatic-name-inference">Automatic name Inference</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#declaring-additional-options">Declaring Additional Options</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#usage-restrictions">Usage restrictions</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#tooling-compatiblity">Tooling Compatiblity</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#transform-api">Transform API</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#inline-vs-non-inline-mode">Inline vs. Non-Inline Mode</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#template-binding-optimization">Template binding optimization</a><!----></li></ul></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">css</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/notes/note/css/弹性布局">弹性布局</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><ul><li>Start Date: 2020-10-28</li><li>Target Major Version: 3.x</li><li>Reference Issues: <a href="https://github.com/vuejs/rfcs/pull/182" target="_blank" rel="noopener noreferrer">https://github.com/vuejs/rfcs/pull/182</a></li><li>Implementation PR: <a href="https://github.com/vuejs/vue-next/pull/2532" target="_blank" rel="noopener noreferrer">https://github.com/vuejs/vue-next/pull/2532</a></li></ul><h1 id="summary"><a class="header-anchor" href="#summary" aria-hidden="true">#</a> Summary</h1><p>Introduce a new script type in Single File Components: <code>&lt;script setup&gt;</code>, which exposes all its top level bindings to the template.</p><h1 id="basic-example"><a class="header-anchor" href="#basic-example" aria-hidden="true">#</a> Basic example</h1><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// imported components are also directly usable in template</span>
  <span class="token keyword">import</span> Foo <span class="token keyword">from</span> <span class="token string">&#39;./Foo.vue&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>

  <span class="token comment">// write Composition API code just like in a normal setup()</span>
  <span class="token comment">// but no need to manually return everything</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">inc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Foo</span> <span class="token attr-name">:count</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>inc<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><details><summary>Compiled Output</summary><div class="language-js"><pre><code><span class="token keyword">import</span> Foo <span class="token keyword">from</span> <span class="token string">&#39;./Foo.vue&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">inc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      count<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>Foo<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">,</span>
        onClick<span class="token operator">:</span> inc<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Note:</strong> the SFC compiler also extracts binding metadata from <code>&lt;script setup&gt;</code> and use it during template compilation. This is why the template can use <code>Foo</code> as a component here even though it&#39;s returned from <code>setup()</code> instead of registered via <code>components</code> option.</p></details><p></p><p><strong>Declaring Props and Emits</strong></p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// expects props options</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    foo<span class="token operator">:</span> String<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// expects emits options</span>
  <span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;update&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;delete&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h1 id="motivation"><a class="header-anchor" href="#motivation" aria-hidden="true">#</a> Motivation</h1><p>This proposal&#39;s main goal is reducing the verbosity of Composition API usage inside Single File Components (SFCs) by directly exposing the context of <code>&lt;script setup&gt;</code> to the template.</p><p>We have a prior proposal for <code>&lt;script setup&gt;</code> <a href="https://github.com/vuejs/rfcs/blob/sfc-improvements/active-rfcs/0000-sfc-script-setup.md" target="_blank" rel="noopener noreferrer">here</a>, which is currently implemented (but marked as experimental). The old proposal opted for the <code>export</code> syntax so that the code would play well with unused variable checks.</p><p>This proposal takes a different direction based on the premise that we can offer customized linter rules in <code>eslint-plugin-vue</code>. This allows us to aim for the most succinct syntax possible.</p><h1 id="detailed-design"><a class="header-anchor" href="#detailed-design" aria-hidden="true">#</a> Detailed design</h1><h2 id="script-setup"><a class="header-anchor" href="#script-setup" aria-hidden="true">#</a> <code>&lt;script setup&gt;</code></h2><p>To opt-in to the syntax, add the <code>setup</code> attribute to the <code>&lt;script&gt;</code> block:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// syntax enabled</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="top-level-bindings-are-exposed-to-template"><a class="header-anchor" href="#top-level-bindings-are-exposed-to-template" aria-hidden="true">#</a> Top level bindings are exposed to template</h3><p>When using <code>&lt;script setup&gt;</code>, the template is compiled into a render function that is inlined inside the setup function scope. This means any top-level bindings (both variables and imports) declared inside <code>&lt;script setup&gt;</code> are directly usable in the template:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">&#39;Hello!&#39;</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>Compiled Output:</strong></p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">&#39;Hello!&#39;</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// has access to everything inside setup() scope</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>It is important to notice the different template scoping mental model vs. Options API: when using Options API, the <code>&lt;script&gt;</code> and the template are connected via a &quot;render context object&quot;. When we write code, we are always thinking about &quot;what properties are exposed on the context&quot;. This naturally leads to concerns of &quot;leaking too much private logic onto the context&quot;.</p><p>When using <code>&lt;script setup&gt;</code>, however, the mental model is simply that of a function inside another function: the inner function has access to everything in the parent scope, and because the parent scope is closure, there is no &quot;leak&quot; to be concerned with.</p><h3 id="using-components"><a class="header-anchor" href="#using-components" aria-hidden="true">#</a> Using Components</h3><p>Values in the scope of <code>&lt;script setup&gt;</code> can also be used directly as custom component tag names, similar to how it works in JSX:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> Foo <span class="token keyword">from</span> <span class="token string">&#39;./Foo.vue&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> MyComponent <span class="token keyword">from</span> <span class="token string">&#39;./MyComponent.vue&#39;</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Foo</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token comment">&lt;!-- kebab-case also works --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-component</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><details><summary>Compiled Output</summary><div class="language-js"><pre><code><span class="token keyword">import</span> Foo <span class="token keyword">from</span> <span class="token string">&#39;./Foo.vue&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MyComponent <span class="token keyword">from</span> <span class="token string">&#39;./MyComponent.vue&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Note</strong>: in this case the template compiler has the binding information to generate code that directly use <code>Foo</code> from setup bindings instead of dynamically resolving it.</p></details><p></p><h3 id="using-dynamic-components"><a class="header-anchor" href="#using-dynamic-components" aria-hidden="true">#</a> Using Dynamic Components</h3><p>Since components are referenced as variables instead of registered under string keys, we should use dynamic <code>:is</code> binding when using dynamic components inside <code>&lt;script setup&gt;</code>:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> Foo <span class="token keyword">from</span> <span class="token string">&#39;./Foo.vue&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> Bar <span class="token keyword">from</span> <span class="token string">&#39;./Bar.vue&#39;</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Foo<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>someCondition ? Foo : Bar<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><details><summary>Compiled Output</summary><div class="language-js"><pre><code><span class="token keyword">import</span> Foo <span class="token keyword">from</span> <span class="token string">&#39;./Foo.vue&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Bar <span class="token keyword">from</span> <span class="token string">&#39;./Bar.vue&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token function">h</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">h</span><span class="token punctuation">(</span>someCondition <span class="token operator">?</span> Foo <span class="token operator">:</span> Bar<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details><h3 id="using-directives"><a class="header-anchor" href="#using-directives" aria-hidden="true">#</a> Using Directives</h3><p>Directives work in a similar fashion - except that a directive named <code>v-my-dir</code> will map to a setup scope variable named <code>vMyDir</code>:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> directive <span class="token keyword">as</span> vClickOutside <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;v-click-outside&#39;</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-click-outside</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><details><summary>Compiled Output</summary><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> directive <span class="token keyword">as</span> vClickOutside <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;v-click-outside&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">withDirectives</span><span class="token punctuation">(</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>vClickOutside<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details><p>The reason for requiring the <code>v</code> prefix is because it is quite likely for a globally registered directive (e.g. <code>v-focus</code>) to clash with a locally declared variable of the same name. The <code>v</code> prefix makes the intention of using a variable as a directive more explicit and reduces unintended &quot;shadowing&quot;.</p><h3 id="declaring-props-and-emits"><a class="header-anchor" href="#declaring-props-and-emits" aria-hidden="true">#</a> Declaring <code>props</code> and <code>emits</code></h3><p>To declare options like <code>props</code> and <code>emits</code> with full type inference support, we can use the <code>defineProps</code> and <code>defineEmits</code> APIs, which are automatically available inside <code>&lt;script setup&gt;</code>:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    foo<span class="token operator">:</span> String<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;change&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;delete&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// setup code</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><details><summary>Compiled output</summary><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    foo<span class="token operator">:</span> String<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  emits<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;change&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;delete&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">{</span> emit <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// setup code</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details><ul><li><p><code>defineProps</code> and <code>defineEmits</code> provides proper type inference based on the options passed.</p></li><li><p><code>defineProps</code> and <code>defineEmits</code> are <strong>compiler macros</strong> only usable inside <code>&lt;script setup&gt;</code>. They do not need to be imported, and are compiled away when <code>&lt;script setup&gt;</code> is processed.</p></li><li><p>The options passed to <code>defineProps</code> and <code>defineEmits</code> will be hoisted out of setup into module scope. Therefore, the options cannot reference local variables declared in setup scope. Doing so will result in a compile error. However, it <em>can</em> reference imported bindings since they are in the module scope as well.</p></li></ul><h3 id="using-slots-and-attrs"><a class="header-anchor" href="#using-slots-and-attrs" aria-hidden="true">#</a> Using <code>slots</code> and <code>attrs</code></h3><p>Usage of <code>slots</code> and <code>attrs</code> inside <code>&lt;script setup&gt;</code> should be relatively rare, since you can access them directly as <code>$slots</code> and <code>$attrs</code> in the template. In the rare case where you do need them, use the <code>useSlots</code> and <code>useAttrs</code> helpers respectively:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> useSlots<span class="token punctuation">,</span> useAttrs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> slots <span class="token operator">=</span> <span class="token function">useSlots</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> attrs <span class="token operator">=</span> <span class="token function">useAttrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>useSlots</code> and <code>useAttrs</code> are actual runtime functions that return the equivalent of <code>setupContext.slots</code> and <code>setupContext.attrs</code>. They can be used in normal composition API functions as well.</p><h3 id="type-only-props-emit-declarations"><a class="header-anchor" href="#type-only-props-emit-declarations" aria-hidden="true">#</a> Type-only props/emit declarations</h3><p>Props and emits can also be declared using pure-type syntax by passing a literal type argument to <code>defineProps</code> or <code>defineEmits</code>:</p><div class="language-ts"><pre><code><span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token generic-function"><span class="token function">defineProps</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  bar<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token generic-function"><span class="token function">defineEmits</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span>
  <span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token string">&#39;change&#39;</span><span class="token punctuation">,</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  <span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token string">&#39;update&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p><code>defineProps</code> or <code>defineEmits</code> can only use either runtime declaration OR type declaration. Using both at the same time will result in a compile error.</p></li><li><p>When using type declaration, equivalent runtime declaration is automatically generated from static analysis to remove the need of double declaration and still ensure correct runtime behavior.</p><ul><li><p>In dev mode, the compiler will try to infer corresponding runtime validation from the types. For example here <code>foo: String</code> is inferred from the <code>foo: string</code> type. If the type is a reference to an imported type, the inferred result will be <code>foo: null</code> (equal to <code>any</code> type) since the compiler does not have information of external files.</p></li><li><p>In prod mode, the compiler will generate the array format declaration to reduce bundle size (the props here will be compiled into <code>[&#39;msg&#39;]</code>)</p></li><li><p>The emitted code is still TypeScript with valid typing, which can be further processed by other tools.</p></li></ul></li><li><p>As of now, the type declaration argument must be one of the following to ensure correct static analysis:</p><ul><li>A type literal</li><li>A reference to a an interface or a type literal in the same file</li></ul><p>Currently complex types and type imports from other files are not supported. It is theoretically possible to support type imports in the future.</p></li></ul><h3 id="default-props-values-when-using-type-declaration"><a class="header-anchor" href="#default-props-values-when-using-type-declaration" aria-hidden="true">#</a> Default props values when using type declaration</h3><p>One drawback of the type-only <code>defineProps</code> declaration is that it doesn&#39;t have a way to provide default values for the props. To resolve this problem, a <code>withDefaults</code> compiler macro is also provided:</p><div class="language-ts"><pre><code><span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span>
  msg<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">defineProps</span><span class="token generic class-name"><span class="token operator">&lt;</span>Props<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  msg<span class="token operator">:</span> <span class="token string">&#39;hello&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This will be compiled to equivalent runtime props <code>default</code> options. In addition, the <code>withDefaults</code> helper provides type checks for the default values, and ensures the returned <code>props</code> type has the optional flags removed for properties that do have default values declared.</p><h3 id="top-level-await"><a class="header-anchor" href="#top-level-await" aria-hidden="true">#</a> Top level await</h3><p>Top level <code>await</code> can be used inside <code>&lt;script setup&gt;</code>. The resulting <code>setup()</code> function will be made <code>async</code>:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/post/1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>In addition, the awaited expression will be automatically wrapped with a <code>withAsyncContext</code> helper. The helper saves and restores the current instance context so that the current instance context is preserved even after the <code>await</code> statement:</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> withAsyncContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">withAsyncContext</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/post/1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> r<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// current instance context preserved</span>
    <span class="token comment">// e.g. onMounted() will still work.</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span> post <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Relevant: <a href="https://github.com/vuejs/rfcs/issues/234" target="_blank" rel="noopener noreferrer">https://github.com/vuejs/rfcs/issues/234</a></p><h3 id="exposing-component-s-public-interface"><a class="header-anchor" href="#exposing-component-s-public-interface" aria-hidden="true">#</a> Exposing component&#39;s public interface</h3><p>In a traditional Vue component, everything exposed to the template is implicitly exposed on the component instance, which can be retrieved by a parent component via template refs. That is to say, up to this point the <strong>template render context</strong> and the <strong>imperative public interface</strong> of a component is one and the same. We have found this to be problematic because the two use cases do not always align perfectly. In fact, most of the time we are over-exposing on the public interface front. This is why we are discussing an explicit way to define a component&#39;s imperative public interface in the <a href="https://github.com/vuejs/rfcs/pull/210" target="_blank" rel="noopener noreferrer">Expose RFC</a>.</p><p>With <code>&lt;script setup&gt;</code> the template has access to the declared variables because it is compiled into a function that is returned from the <code>setup()</code> function scope. This means all the variables declared are in fact never returned: they are contained inside the <code>setup()</code> closure. As a result, a component using <code>&lt;script setup&gt;</code> will be <strong>closed by default</strong>. That is to say, its public imperative interface will be an empty object unless bindings are explicitly exposed.</p><p>To explicitly expose properties in a <code>&lt;script setup&gt;</code> component, use the <code>defineExpose</code> compiler macro:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">defineExpose</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    a<span class="token punctuation">,</span>
    b<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>When a parent gets an instance of this component via template refs, the retrieved instance will be of the shape <code>{ a: number, b: number }</code> (refs are automatically unwrapped just like on normal instances).</p><p>This will be compiled into the runtime equivalent as proposed in the <a href="https://github.com/vuejs/rfcs/pull/210" target="_blank" rel="noopener noreferrer">Expose RFC</a>.</p><h2 id="usage-alongside-normal-script"><a class="header-anchor" href="#usage-alongside-normal-script" aria-hidden="true">#</a> Usage alongside normal <code>&lt;script&gt;</code></h2><p>There are some cases where the code must be executed in the module scope, for example:</p><ul><li><p>Declaring named exports</p></li><li><p>Global side effects that should only execute once.</p></li></ul><p>In such cases, a normal <code>&lt;script&gt;</code> block can be used alongside <code>&lt;script setup&gt;</code>:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token function">performGlobalSideEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// this can be imported as `import { named } from &#39;./*.vue&#39;`</span>
  <span class="token keyword">export</span> <span class="token keyword">const</span> named <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><details><summary>Compile Output</summary><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>

<span class="token function">performGlobalSideEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> named <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      count<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></details><h2 id="automatic-name-inference"><a class="header-anchor" href="#automatic-name-inference" aria-hidden="true">#</a> Automatic <code>name</code> Inference</h2><p>Vue 3 SFCs automatically infers the component&#39;s name from the component&#39;s <strong>filename</strong> in the following cases:</p><ul><li><p>Dev warning formatting</p></li><li><p>DevTools inspection</p></li><li><p>Recursive self-reference. E.g. a file named <code>FooBar.vue</code> can refer to itself as <code>&lt;FooBar/&gt;</code> in its template.</p><p>This has lower priority than explicity registered/imported components. If you have a named import that conflicts with the component&#39;s inferred name, you can alias it:</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> FooBar <span class="token keyword">as</span> FooBarChild <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./components&#39;</span><span class="token punctuation">;</span>
</code></pre></div></li></ul><p>In most cases, explicit <code>name</code> declaration is not needed. The only cases where you do need it is when you need the <code>name</code> for <code>&lt;keep-alive&gt;</code> inclusion / exclusion or direct inspection of the component&#39;s options.</p><h2 id="declaring-additional-options"><a class="header-anchor" href="#declaring-additional-options" aria-hidden="true">#</a> Declaring Additional Options</h2><p>The <code>&lt;script setup&gt;</code> syntax provides the ability to express equivalent functionality of most existing Options API options except for a few:</p><ul><li><code>name</code></li><li><code>inheritAttrs</code></li><li>Custom options needed by plugins or libraries</li></ul><p>If you need to declare these options, use a separate normal <code>&lt;script&gt;</code> block with <code>export default</code>:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&#39;CustomName&#39;</span><span class="token punctuation">,</span>
    inheritAttrs<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    customOptions<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// script setup logic</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="usage-restrictions"><a class="header-anchor" href="#usage-restrictions" aria-hidden="true">#</a> Usage restrictions</h2><p>Due to the difference in module execution semantics, code inside <code>&lt;script setup&gt;</code> relies on the context of an SFC. When moved into external <code>.js</code> or <code>.ts</code> files, it may lead to confusions for both developers and tools. Therefore, <strong><code>&lt;script setup&gt;</code></strong> cannot be used with the <code>src</code> attribute.</p><h1 id="drawbacks"><a class="header-anchor" href="#drawbacks" aria-hidden="true">#</a> Drawbacks</h1><h2 id="tooling-compatiblity"><a class="header-anchor" href="#tooling-compatiblity" aria-hidden="true">#</a> Tooling Compatiblity</h2><p>This new scoping model will require tooling adjustments in two aspects:</p><ol><li><p>IDEs will need to provide dedicated handling for this new <code>&lt;script setup&gt;</code> model in order to provide template expression type checking / props validation, etc.</p><p>As of now, <a href="https://github.com/johnsoncodehk/volar" target="_blank" rel="noopener noreferrer">Volar</a> already provides full support for this RFC in VSCode, including all TypeScript related features. Its internals are also implemented as a landuage server that can theoretically be used in other IDEs.</p></li><li><p>ESLint rules like <code>no-unused-vars</code>. We will need a replacement rule in <code>eslint-plugin-vue</code> that takes both the <code>&lt;script setup&gt;</code> and <code>&lt;template&gt;</code> expressions into account.</p></li></ol><h1 id="adoption-strategy"><a class="header-anchor" href="#adoption-strategy" aria-hidden="true">#</a> Adoption strategy</h1><p>This feature is opt-in. Existing SFC usage is unaffected.</p><h1 id="unresolved-questions"><a class="header-anchor" href="#unresolved-questions" aria-hidden="true">#</a> Unresolved questions</h1><ul><li><p>Type-only props/emits declarations currently do not support using externally imported types. This is useful when reusing base props type definitions across multiple components.</p><p>The type inference already works as expected in Volar&#39;s IDE support, the limitation is purely in that <code>@vue/compiler-sfc</code> needs to know the props keys in order to generate the correct equivalent runtime declarations.</p><p>This is technically possible if we implement the logic to follow along type imports, read, and parse the import source. However, this is more of an implementation scope problem and does not fundamentally affect how the RFC design behaves.</p></li></ul><h1 id="appendix"><a class="header-anchor" href="#appendix" aria-hidden="true">#</a> Appendix</h1><blockquote><p>The following sections are only for tooling authors that needs to support <code>&lt;script setup&gt;</code> in respective SFC tooling integrations.</p></blockquote><h2 id="transform-api"><a class="header-anchor" href="#transform-api" aria-hidden="true">#</a> Transform API</h2><p>The <code>@vue/compiler-sfc</code> package exposes the <code>compileScript</code> method for processing <code>&lt;script setup&gt;</code>:</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> parse<span class="token punctuation">,</span> compileScript <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vue/compiler-sfc&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> descriptor <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>descriptor<span class="token punctuation">.</span>script <span class="token operator">||</span> descriptor<span class="token punctuation">.</span>scriptSetup<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">compileScript</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns SFCScriptBlock</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>bindings<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// see next section</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The compilation requires the entire descriptor to be provided, and the resulting code will include sources from both <code>&lt;script setup&gt;</code> and normal <code>&lt;script&gt;</code> (if present). It is the higher level tools&#39; (e.g. <code>vite</code> or <code>vue-loader</code>) responsibility to properly assemble the compiled output.</p><h2 id="inline-vs-non-inline-mode"><a class="header-anchor" href="#inline-vs-non-inline-mode" aria-hidden="true">#</a> Inline vs. Non-Inline Mode</h2><p>During development, <code>&lt;script setup&gt;</code> still compiles to returned object instead of inlined render function for two reasons:</p><ol><li>Devtools inspection</li><li>Template hot-reloading (HMR)</li></ol><p>Inline template mode is only used in production and can be enabled via the <code>inlineTemplate</code> option:</p><div class="language-js"><pre><code><span class="token function">compileScript</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">,</span> <span class="token punctuation">{</span> inlineTemplate<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In inline mode, some bindings (e.g. return values from <code>ref()</code> calls) need to be wrapped with <code>unref</code>:</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> <span class="token function">unref</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>The compiler performs some heuristics to avoid this when possible. For example, function declarations and const declarations with literal initial values will not be wrapped with <code>unref</code>.</p><h2 id="template-binding-optimization"><a class="header-anchor" href="#template-binding-optimization" aria-hidden="true">#</a> Template binding optimization</h2><p>The <code>SFCScriptBlock</code> returned by <code>compiledScript</code> also exposes a <code>bindings</code> object, which is the exported binding metadata gathered during the compilation. For example, given the following <code>&lt;script setup&gt;</code>:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>props<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    props<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;bar&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>The <code>bindings</code> object will be:</p><div class="language-js"><pre><code><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token string">&#39;setup-const&#39;</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token string">&#39;props&#39;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This object can then be passed to the template compiler:</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> compile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vue/compiler-dom&#39;</span><span class="token punctuation">;</span>

<span class="token function">compile</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  bindingMetadata<span class="token operator">:</span> bindings<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>With the binding metadata available, the template compiler can generate code that directly access template variables from the corresponding source, without having to go through the render context proxy:</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ foo + bar }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js"><pre><code><span class="token comment">// code generated without bindingMetadata</span>
<span class="token comment">// here _ctx is a Proxy object that dynamically dispatches property access</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">createVNode</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> _ctx<span class="token punctuation">.</span>foo <span class="token operator">+</span> _ctx<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// code generated with bindingMetadata</span>
<span class="token comment">// bypasses the render context proxy</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">createVNode</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> $setup<span class="token punctuation">.</span>foo <span class="token operator">+</span> $props<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The binding information is also used in inline template mode to generate more efficient code.</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/notes/note/js/基础" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>基础</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/notes/note/css/弹性布局" data-v-38ede35f><span class="text" data-v-38ede35f>弹性布局</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"66c11003\",\"pages_about.md\":\"3f773a8d\",\"pages_archives.md\":\"d0b87633\",\"pages_tags.md\":\"5a45bd34\",\"note_index.md\":\"e3594c12\",\"note_js_基础.md\":\"781947a0\",\"note_css_弹性布局.md\":\"fb4d5911\",\"note_vue_scriptup.md\":\"3bafb0dd\"}")</script>
    <script type="module" async src="/notes/assets/app.72f529ff.js"></script>
  </body>
</html>